
\subsection{Counterflow diffusion flame}\label{ss:CDF}
\begin{figure}[b]
	\begin{center}
		\def\svgwidth{0.8\textwidth}
		\import{./plots/}{CounterDiffusionFlame_sketch_rotated2.pdf_tex}
		\caption{Schematic representation of the counterflow configuration.}
		\label{fig:CDFScheme}
	\end{center}
\end{figure}
%TODO INCLUDE coordinate system. Si lo pongo 
%This test case is the main prototype flame for diffusion regimes \cite{poinsotTheoreticalNumericalCombustion2005}.
The counterflow diffusion flame is a canonical configuration used to study the structure of nonpremixed flames. This simple configuration has been a subject of study for decades because it provides a simple way of creating a strained diffusion flame, which proves to be useful when studying the flame structure, extinction limits or production of pollutants of flames \citep{pandyaStructureFlatCounterFlow1964,spaldingTheoryMixingChemical1961,keyesFlameSheetStarting1987}. It consists of two oppositely situated jets. The fuel (possibly mixed with some inert component, such as nitrogen) is fed into the system by one of the jets, while the other jet feeds oxidyzer to the system, thereby establishing a stagnation point flow. On contact and after ignition, the reactants produce a flame that is located in the vicinity of the stagnation plane. A diagram of the setup can be seen in \cref{fig:CDFScheme}. In this section, the solution of a two-dimensional flame formed in an infinitely long slot burner will be treated. Simirlarly to the coflow configuration treated before, the infintely long slot burner configuration can be calculated naturally using cartesian coordinates.

As a first result, as a means of verificating the solver for combustion applications, the results obtained with the XNSEC-solver for steady two-dimensional counterflow diffusion flames at different strains are compared with the solution of a simplified system of equations for a steady and quasi one-dimensional flame. Aditionally some remarks concerning the convergence behaviour of the case counter diffusion flame are given. 


\subsubsection{The one-dimensional diffusion flame}
By assuming an infinite injector diameter and self-similarity of the solution, it is possible to reduce the three-dimensional governing equations to a one-dimensional formulation along the stagnation streamline $x = 0$ \citep{keeChemicallyReactingFlow2003}. The governing equations for a steady planar stagnation flow reduce to
\begin{gather}
	%%%%%%%%%%
	\frac{\partial\rho v}{\partial y} +  \rho U = 0\\ \label{eq:OneDimCont}%
	%%%%%%%%%%
	\rho v \frac{\partial U}{\partial y} + \rho U^2 =
	- \Lambda
	+ \frac{\partial}{\partial y}\left(\mu \frac{\partial U}{\partial y}\right)\\ \label{eq:OneDimMom}%
	%%%%%%%%%%
	\rho c_p v \frac{\partial T}{\partial y} =
	\frac{\partial}{\partial y}\left(\lambda \frac{\partial T}{\partial y}\right)
	%	- \sum_k j_k c_{p,k} \frac{\partial T}{\partial x}
	+\heatRelease~\mathcal{Q}\\
	%%%%%%%%%%%
	\rho v \frac{\partial Y_k}{\partial y} = 
	\frac{\partial}{\partial y}\left(\rho D \frac{\partial Y_k}{\partial y}\right)
	+ W_k \stoicCoef_k \mathcal{Q}
	%%%%%%%%%%%
\end{gather}\label{eqs:OneDimEquations}
where $U$ is the scaled velocity and $\Lambda$ is the pressure eigenvalue which is independant of $y$. These equations are written assuming a valid Fick's law and a one-step combustion model. Aditionally an equation of state and expressions for the heat capacity $c_p$ and transport parameters $\mu, \lambda, (\rho D)$ have to be given. This system of equations is the starting point for many studies. In order to compare the ability of the XNSEC-solver to simulate a system such as the counter diffusion flame, the quasi one-dimensional equations are solved with \lstinline|BVP4|, a fourth order finite difference boundary value problem solver provided by \lstinline|MATLAB| \citep{kierzenkaBVPSolverBased2001}. The  \lstinline|BVP4| solver provides automatic meshing and error control based on the residuals of the solution. 

It is interesting to mention some points regarding the solution of these equations using the \lstinline|BVP4| solver. To obtain a convergent solution of the equations, several difficulties had first to be solved. Analogous to the problem mentioned in \cref{ssec:MethodCombustion}, the solution of the system of equations \cref{eqs:OneDimEquations} presents the particularity that it is possible to find multiple solutions. One of them is clearly the cold solution and another solution is the one that presents a flame. The same idea mentioned in  \cref{ssec:MethodCombustion} is obviously also valid for the quasi one-dimensional configuration. In particular this means, that as a first step for finding a converged solution of \cref{eqs:OneDimEquations},  the system

\begin{gather}
	%%%%%%%%%%
	\frac{\partial\rho v}{\partial y} +  \rho U = 0\\ \label{eq:OneDimCont2}%
	%%%%%%%%%%
	\rho v \frac{\partial U}{\partial y} + \rho U^2 =
	- \Lambda
	+ \frac{\partial}{\partial y}\left(\mu \frac{\partial U}{\partial y}\right)\\ \label{eq:OneDimMom2}%
	%%%%%%%%%%
    	\rho v \frac{\partial Z}{\partial y} = 
	\frac{\partial}{\partial y}\left(\rho D \frac{\partial Z}{\partial y}\right)
	%%%%%%%%%%%
\end{gather}\label{eqs:OneDimEquationsMixtureFraction}
is solved together  with the equation of state \cref{eq:ideal_gas} and expressions for the transport parameters. Obviously the dependence of these parameters with the temperature and mass fractions is still given by \cref{eq:BS-T, eq:BS-YF, eq:BS-YO, eq:BS-YP}. 
An inconvenience is that an initial estimate for the $c_p$ has to be chosen. It was observed that if the value of $c_p$ was chosen too big, the solver delivered the no-flame solution. For the calculations treated here $c_p = 1.3$ was an adequate value that delivered the ignited solution. However, it was observed that this flamesheet solution wasnt directly useful as an initial estimation for the solution of the full system of equations. In order to help  the \lstinline|BVP4| solver to find a coverged solution, an intermediate step was necesary. First, the flamesheet solution was used as an initial estimate



A second issue was that the flamesheet solution wasnt directly useful as an initial estimation of the full system. As an intermediate step, it was observed tha


\subsubsection{Set-up}
The combustion of a methane-nitrogen mixture with air was simulated. The mass composition of the fuel inlet was assumed to be  $Y^0_{\ch{CH4}} = 0.2$ and $Y^0_{\ch{N2}} = 0.8$, and the oxidizer inlet corresponds to air with   $Y^0_{\ch{O2}} = 0.23$ and $Y^0_{\ch{N2}} = 0.77$. Because we are dealing with an open system, the thermodynamic pressure $\hat p_0$ is constant and set to the ambient pressure of $\SI{101325}{\pascal}$. 
 although the form of the inlet velocity profiles does have an influence on the solution of the problem, its effect on the solution near the flame zone is rather small. Nevertheless, the solution of the self-similar one-dimensional problem assumed an infinite injector diameter, which implies that the upstream velocity field has to be constant. Based on this fact we set the velocity profile of both inlets as a plug flow. Following combinations of inlet velocities were calculated:
\begin{itemize}
	\item  Low inlet velocities:  $u^0_{\text{fuel}} = \SI{0.048}{\meter \per \second}$ and  $u^0_{\text{oxidizer}} = \SI{0.144}{\meter \per \second}$,
	\item Medium inlet velocities:  $u^0_{\text{fuel}} = \SI{0.12}{\meter \per \second}$ and  $u^0_{\text{oxidizer}} = \SI{0.36}{\meter \per \second}$
	\item High inlet velocities: $u^0_{\text{fuel}}  = \SI{0.24}{\meter \per \second}$ and   $u^0_{\text{oxidizer}} = \SI{0.72}{\meter \per \second}$
\end{itemize}
By using as definition of the strain rate the maximum axial velocity gradient, the calculated strains for the three cases mentioned above are $\SI{34}{\per\second}$, $\SI{76}{\per\second}$ and $\SI{155}{\per\second}$, respectively. The temperature of both inlets is \SI{300}{\kelvin}. The separation between both jets $\hat L$ is equal to $\SI{0.02}{\meter}$, and the length of the inlet opening $\hat D$ is $\SI{0.02}{\meter}$. The left and right domain boundaries are selected to be at a distance $3\hat L$ of the center. A non-unity but constant Lewis number formulation is used,with
$\Lewis_{\ch{CH4}} =  0.97 $ , $\Lewis_{\ch{O2}} = 1.11 $, $\Lewis_{\ch{H2O}} = 0.83 $ and $\Lewis_{\ch{CO2}} = 1.39 $.\cite{smookePremixedNonpremixedTest1991} The heat capacity of each component is evaluated locally from NASA polynomials, and the mixture heat capacity is calculated with \cref{eq:nondim_cpmixture}.
In \cref{fig:CDF_ConvergenceStory} the convergence history obtained for a typical calculation of the counter diffusion flame is presented. The solution of the flame sheet calculation requires 17 iterations until convergence is reached. The obtained solution is used as a starting value for the finite chemical rate calculation, which only needs 10 iterations until convergence is reached. We note that because the flame sheet calculation is only used as an approximation of the final solution, a low polynomial degree can be used. For the flame sheet calculation $k = 2$ was chosen, resulting in a rather small system with 26,880 degrees of freedom. For the finite rate calculation $k = 4$ was used, which resulted in a system with 174,110 degrees of freedom.  With the above-mentioned another advantage of the approach of using the flame sheet calculation for two-dimensional simulations can be highlighted. The initial estimate can be found relatively easily for a system with few degrees of freedom. Using the solution found as the initial estimate has the consequence that Newton's algorithm for the complete problem (which has many more degrees of freedom) only needs a few iterations to find a solution.
\begin{figure}[h]
	\centering
	\pgfplotsset{width=0.73\textwidth, compat=1.3}
	\inputtikz{CounterFlowFlameMesh}	
	\inputtikz{CounterFlowFlameStreamlines}
	\inputtikz{CounterFlowFlameTemperature}
	\inputtikz{CounterFlowFlamekReact}
	\inputtikz{CounterFlowFlameDensity}		
	\caption{Nondimensional solution and derived fields of the counterflow flame configuration for case (a).} \label{fig:CoFlowFlameFig1}
\end{figure}
\begin{figure}[h]
	\ContinuedFloat
	\centering
	\pgfplotsset{width=0.73\textwidth, compat=1.3}	
	\inputtikz{CounterFlowFlamePressure}	
	\inputtikz{CounterFlowFlameCpMixture}	
	\inputtikz{CounterFlowFlameMF0}
	\inputtikz{CounterFlowFlameMF1}
	\inputtikz{CounterFlowFlameMF2}
	\inputtikz{CounterFlowFlameMF3}
	%	\inputtikz{CounterFlowFlameDensity}	
	\caption{Solution and derived fields of the counterflow flame configuration with a strain of \SI{34}{\per \second} (continued).}% \label{fig:CoFlowFlameFig1}
\end{figure}
Because we are solving a two-dimensional configuration, in order to be able to compare our results with the ones obtained from the one-dimensional representation, the temperature, mass fractions and velocity profiles are extracted along the centerline of the system shown as the dashed line in \cref{fig:CDFScheme}. In \cref{fig:BoSSS_1D_Comparison_velocity} a comparison of the axial velocities calculated with \BoSSS and the one-dimensional solution is shown. While for the high strain case the results agree closely, for lower strains a discrepancy is observed. Recall that the derivation of the one-dimensional approximation assumes a constant velocity field incoming to the flame zone in order to obtain a self-similar solution. In the case of the two-dimensional configuration presented here, the border effects do have an influence on the centerline, which disrupts the self-similarity. This effect is more pronounced for low velocities, which explains the discrepancy between curves. Similarly, In \cref{fig:BoSSS_1D_Comparison} the temperature and mass fraction fields are presented. Again, a discrepancy is observed for low strains, but results show a good agreement for higher inlet velocities. It can also be observed how, as expected, \cite{fernandez-tarrazoSimpleOnestepChemistry2006} at higher strains a significant penetration (leakage) of oxygen across the flame is present. Finally, in \cref{fig:TempAndReacFields} the two-dimensional temperature, velocity and reaction rate fields for the case (a) are shown.
\begin{figure}
	\centering
	\inputtikz{SmoothingPicture}
	\caption{Temperature profile calculated in the center-line of a counter-flow flame configuration for different smoothing parameters $\sigma$.}
	\label{fig:smoothings}
\end{figure}

Finally, in \Cref{fig:TemperatureConvergenceDiffFlame} we show how the maximum value of the temperature behaves for different mesh resolutions and polynomial degrees. The temperature tends to a limit value, and we observe how this value is reached already for coarse meshes when using a polynomial degree of three or four. We also observe that for $k=2$ the temperature tends to a limit value, but slower in comparison to $k =3$ or $4$. The values for $k=1$ are not displayed because for the mesh resolutions shown here, the values of the maximum temperature were of the order of 50 \si{K} bigger than the limit value. We note that the solution of this configuration showed singularities in the boundary points where the inlet and wall meet. This fact made hard to realize a $h$-convergence study for the complete domain. Based on this we decided to analyse a flame configuration that doesn't exhibit this behaviour, as shown in the next section.
% Finally, for the finite reaction rate calculation also several pseudo-timestep were done, and after each one of them the cells with high temperature gradients are refined (ser mas especifico con esto.)
% For reactive flows, this strategy is based on the variable $\omega$.
% Before each refinement step the values of $\omega$ are normalized by the highest value of the domain, and according to this normalized effects the cells are refined. %In Figure \ref{fig:AMR} the refined meshes can be seen. The legend of the pseudocolor plots is not shown, because for each plot the magnitude scales are different, and just the normalized value accounts for the AMR. 

We note that the solution of this configuration showed singularities in the boundary points where the inlet and wall meet, which induces a pollution phenomenon on the accuracy of the solution. This fact made hard to realize an $h$-convergence study for the complete domain. Based on this fact we decided to analyze a flame configuration that does not exhibit this behaviour, as shown in the next section.
\begin{figure}[t!]
	\pgfplotsset{
		width=0.97\textwidth,
		group/xticklabels at=edge bottom,
		legend style = {
			at ={ (0.49,1), anchor= north east}
		},
		unit code/.code={\si{#1}}
	}
	\centering
	\inputtikz{BoSSS_1D_Comparison_velocity}
	\caption{Comparison of the axial velocity calculated with the XNSEC-solver and the one-dimensional approximation.}
	\label{fig:BoSSS_1D_Comparison_velocity}
\end{figure}
\newpage
\tikzexternaldisable
%\tikzset{external/export next=false}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[b!]
	\centering
	\pgfplotsset{
		width=0.85\textwidth,
		height = 0.3\textwidth,
		compat=1.3,
		tick align = outside,
		yticklabel style={/pgf/number format/fixed},
	}
	\inputtikz{BoSSS_1D_Comparison1}
	\inputtikz{BoSSS_1D_Comparison2}
	\inputtikz{BoSSS_1D_Comparison3}
	\caption{Comparison of temperature and mass fraction fields obtained with \BoSSS and the one-dimensional approximation.}
	\label{fig:BoSSS_1D_Comparison}
\end{figure}
\tikzexternalenable


%\begin{figure}[b]
%	\begin{center}
%		\def\svgwidth{0.8\textwidth}
%		\import{./plots/}{CDF_Results.pdf_tex}
%		\caption{Calculated temperature and velocity fields (top picture) and reaction rate (second picture) of the counter diffusion flame configuration, case (a). The unit of the temperature is \si{K} and of the reaction rate \si{\kilo\mole \per \meter \cubed \per \second}. }
%		\label{fig:TempAndReacFields}
%	\end{center}
%\end{figure}




\subsubsection{Comparison with one-dimensional flame}

 
\subsubsection{Temperature convergence study}
Un estudio de convergencia global para esta configuracion presenta resulta problematica. Similarmente a problemas presentados anteriormente, la presencia de singularidades provoca un efecto de pululacion que degenera los valores de error global. Sin embargo, es de todas formas posible observar que algun valor puntual caracteristico si converge a un valor fijo. En \cref{fig:TemperatureConvergenceDiffFlame} se muestra como varía la temperatura máxima obtenida para la configuracion (b), cuando se varía el numero de elementos, y para diferentes grados de polinomio.  Values for $k=1$ are not shown, because for this range of cell lengths the maximum temperature value was of the order of (50K higher than the ones depicted here

\begin{figure}[tbp]
	\centering
	\inputtikz{TemperatureConvergenceDiffFlame}
	\caption{Maximum value of the temperature for the counter diffusion flame configuration, for different mesh sizes in the x-direction and polynomial degrees..}
	\label{fig:TemperatureConvergenceDiffFlame}
\end{figure}
\FloatBarrier
\newpage
